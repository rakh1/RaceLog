<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaceLog - Session Notes</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/" class="logo">RaceLog</a>
            <div class="nav-links">
                <a href="/">Cars</a>
                <a href="/tracks.html">Tracks</a>
            </div>
            <div class="user-info">
                <a href="/account.html" class="username">Logged in as <strong id="current-username"></strong></a>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="breadcrumb">
            <a href="/tracks.html">Tracks</a>
            <span>/</span>
            <a href="#" id="track-link">Loading...</a>
            <span>/</span>
            <span>Session Notes</span>
        </div>

        <div class="page-header">
            <div>
                <h1 id="track-name-title">Loading...</h1>
                <p class="text-muted">Session Notes</p>
            </div>
        </div>

        <div class="session-notes-layout">
            <!-- Left column: Fixed track map -->
            <div class="session-notes-map">
                <div id="track-image-container" class="track-image-container" style="display: none;">
                </div>
                <div id="map-resize-control" class="map-resize-control" style="display: none;">
                    <label for="mapSizeSlider">Map Size:</label>
                    <input type="range" id="mapSizeSlider" min="150" max="600" value="280" oninput="resizeTrackMap(this.value)">
                </div>
            </div>

            <!-- Right column: Scrollable content -->
            <div class="session-notes-content">
                <!-- Car Selector -->
                <div class="session-selector-section">
                    <div class="selector-row">
                        <label for="sessionNotesCar">Car:</label>
                        <select class="form-control" id="sessionNotesCar" onchange="onSessionNotesCarChange()">
                            <option value="">Select a car...</option>
                        </select>
                    </div>
                </div>

                <!-- Session Selector (shown after car is selected) -->
                <div id="session-selector-container" class="session-selector-section" style="display: none;">
                    <div class="selector-row">
                        <label for="sessionSelect">Session:</label>
                        <select class="form-control" id="sessionSelect" onchange="onSessionChange()">
                            <option value="">Select a session...</option>
                        </select>
                        <button class="btn btn-primary btn-sm" onclick="showAddSessionModal()">Add Session</button>
                    </div>
                    <div id="session-info" class="session-info" style="display: none;">
                        <span id="session-type-badge" class="badge"></span>
                        <span id="session-date"></span>
                        <span id="session-conditions"></span>
                        <button class="btn btn-secondary btn-sm" onclick="editCurrentSession()">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCurrentSession()">Delete</button>
                    </div>
                </div>

                <!-- Session Car Setup (shown after session is selected) -->
                <div id="session-setup-section" class="card" style="display: none; margin-bottom: 1.5rem;">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2>Session Car Setup</h2>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="showImportSetupModal()">Import from Car Setup</button>
                    </div>
                    <div class="card-body">
                        <form id="session-setup-form">
                            <div class="setup-columns">
                                <div class="setup-column">
                                    <h3 class="section-title">Tyre Pressures (psi)</h3>
                                    <div class="grid-2x2">
                                        <div class="form-group">
                                            <label for="sessionTpFL">Front Left</label>
                                            <input type="number" step="0.1" class="form-control" id="sessionTpFL" name="sessionTpFL" placeholder="e.g., 26">
                                        </div>
                                        <div class="form-group">
                                            <label for="sessionTpFR">Front Right</label>
                                            <input type="number" step="0.1" class="form-control" id="sessionTpFR" name="sessionTpFR" placeholder="e.g., 26">
                                        </div>
                                        <div class="form-group">
                                            <label for="sessionTpRL">Rear Left</label>
                                            <input type="number" step="0.1" class="form-control" id="sessionTpRL" name="sessionTpRL" placeholder="e.g., 26">
                                        </div>
                                        <div class="form-group">
                                            <label for="sessionTpRR">Rear Right</label>
                                            <input type="number" step="0.1" class="form-control" id="sessionTpRR" name="sessionTpRR" placeholder="e.g., 26">
                                        </div>
                                    </div>
                                </div>
                                <div class="setup-column">
                                    <h3 class="section-title">Setup</h3>
                                    <div class="form-group">
                                        <label for="sessionFrontARB">Front ARB</label>
                                        <input type="text" class="form-control" id="sessionFrontARB" name="sessionFrontARB" placeholder="e.g., 4">
                                    </div>
                                    <div class="form-group">
                                        <label for="sessionRearARB">Rear ARB</label>
                                        <input type="text" class="form-control" id="sessionRearARB" name="sessionRearARB" placeholder="e.g., 3">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="sessionSetupComments">Comments</label>
                                <textarea class="form-control" id="sessionSetupComments" name="sessionSetupComments" rows="3" placeholder="Setup notes for this session..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Setup</button>
                                <span id="session-setup-status" class="save-status"></span>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Focus Areas (shown after session is selected) -->
                <div id="focus-areas-section" class="card" style="display: none; margin-bottom: 1.5rem;">
                    <div class="card-header">
                        <h2>Focus Areas</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="bestLaptime">Best Laptime</label>
                                <input type="text" class="form-control" id="bestLaptime" name="bestLaptime" placeholder="e.g., 1:42.5">
                            </div>
                            <div class="form-group">
                                <label for="idealLaptime">Ideal Laptime</label>
                                <input type="text" class="form-control" id="idealLaptime" name="idealLaptime" placeholder="e.g., 1:41.2">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="focusAreas">Focus Areas</label>
                            <textarea class="form-control" id="focusAreas" rows="5" placeholder="What to focus on for this session..."></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="saveFocusAreas()">Save</button>
                            <span id="focus-areas-status" class="save-status"></span>
                        </div>
                    </div>
                </div>

                <!-- Corner Notes (shown after session is selected) -->
                <div id="corner-notes-section" style="display: none;">
                    <h2 class="section-title">Corner Notes</h2>
                    <div id="corner-notes-container" class="corner-notes-container">
                        <p class="corner-notes-empty">Select a session to view and edit corner notes</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Setup Modal -->
    <div class="modal" id="import-setup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import from Car Setup</h2>
                <button class="modal-close" onclick="closeModal('import-setup-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="importSetupSelect">Select Setup</label>
                    <select class="form-control" id="importSetupSelect">
                        <option value="">Loading setups...</option>
                    </select>
                </div>
                <p class="text-muted" style="font-size: 0.875rem;">This will overwrite the current session setup values with the selected car setup.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('import-setup-modal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="importSelectedSetup()">Import</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Session Modal -->
    <div class="modal" id="session-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="session-modal-title">Add Session</h2>
                <button class="modal-close" onclick="closeModal('session-modal')">&times;</button>
            </div>
            <form id="session-form" onsubmit="saveSession(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="sessionType">Session Type</label>
                        <select class="form-control" id="sessionType" name="sessionType" required onchange="updateSessionNameDefault()">
                            <option value="">Select type...</option>
                            <option value="Test">Test</option>
                            <option value="Qualifying">Qualifying</option>
                            <option value="Race">Race</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sessionName">Session Name</label>
                        <input type="text" class="form-control" id="sessionName" name="sessionName" placeholder="e.g., Morning Test, Race 1">
                        <small class="text-muted">Leave blank to use session type as name</small>
                    </div>
                    <div class="form-group">
                        <label for="sessionDate">Date</label>
                        <input type="date" class="form-control" id="sessionDate" name="sessionDate" required>
                    </div>
                    <div class="form-group">
                        <label for="sessionConditions">Track Conditions</label>
                        <input type="text" class="form-control" id="sessionConditions" name="sessionConditions" placeholder="e.g., Dry, 25C, Sunny">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('session-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Session</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
